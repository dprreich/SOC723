<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HW3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="HW3_files/libs/clipboard/clipboard.min.js"></script>
<script src="HW3_files/libs/quarto-html/quarto.js"></script>
<script src="HW3_files/libs/quarto-html/popper.min.js"></script>
<script src="HW3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="HW3_files/libs/quarto-html/anchor.min.js"></script>
<link href="HW3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="HW3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="HW3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="HW3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="HW3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HW3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="week-3-hw" class="level2">
<h2 class="anchored" data-anchor-id="week-3-hw">Week 3 HW</h2>
<p>Setup</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_light</span>(<span class="at">base_family =</span> <span class="st">"Optima"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">3.1</h2>
<ul>
<li><p>Fill in the missing cells.</p>
<table class="table">
<tbody>
<tr class="odd">
<td><strong>Group (T)</strong></td>
<td>E[Y1]</td>
<td>E[Y0]</td>
</tr>
<tr class="even">
<td>T = 1</td>
<td>10,000</td>
<td>5,000</td>
</tr>
<tr class="odd">
<td>T = 0</td>
<td>10,000</td>
<td>5,000</td>
</tr>
</tbody>
</table></li>
<li><p>What is the ATE?</p>
<p><strong>1,500 (10,000 - 5,000 = 5,000 * 0.3 = 1,500)</strong></p></li>
</ul>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">3.2</h2>
<p><strong>Old terms</strong></p>
<ol type="1">
<li>Theoretical Estimand: This is the actual thing we would like to know. The two components of which are the unit-specific quantity and the target population. The theoretical estimand includes both observed and unobserved data (including counterfactuals).</li>
<li>Empirical Estimand: The empirical estimand is the target of inference that only includes observable data and relies on identification assumptions.</li>
<li>Directed Acyclic Graphs: A tool for visualizing causal diagrams in which causality is directed by pointed arrows and nodes cannot reference themselves.</li>
<li>Causal Interaction: Intervention to two variables averaged over one population. Effect of one variable on the outcome is related to the effect of another. (Example given in article: Black &amp; White applicants, criminal record vs no criminal record. Effect of criminal record on getting an interview might be different for Black and White applicants.)</li>
<li>Effect Heterogeneity: Intervention to one variable averaged over two populations. (I’m a little confused about the difference between this and Causal Interaction.)</li>
</ol>
<p><strong>New terms</strong></p>
<ul>
<li><p>DAG. - Directed acyclic graph - A type of causal diagram in which all arrows are directed from one node to another, and there are no cycles.</p></li>
<li><p>Paths. - A path is simply the steps from one variable to another on a causal diagram. A -&gt; B -&gt; C is a path.</p></li>
<li><p>Direct effects. - The effect of only the treatment variable on the outcome variable.</p></li>
<li><p>Indirect effects. - The effect(s) of the treatment variable on the outcome variable that includes paths through other variables.</p></li>
<li><p>Total effects. - The sum of the direct and indirect effects.</p></li>
<li><p>Front door paths. - A path where all the arrows point away from Treatment</p></li>
<li><p>Back door paths. - A path where at least one arrow points towards Treatment.</p></li>
<li><p>Confounding. - When open back door paths affect the relationship between Treatment and Outcome. Often occurs through unmeasured or unobserved variables.</p></li>
<li><p>Collider. - A variable along a path with arrows on both sides pointing at it.</p></li>
<li><p>Open Path. - A path in which there is variation in all variables along the path (and no variation in any colliders on that path)</p></li>
<li><p>Closed Path. - A path in which there is at least one variable with no variation (or a collider with variation)</p></li>
</ul>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2">3.3</h2>
<p><br>
Draw a causal diagram for the research question “do long shift hours make doctors give lower-quality care?” that incorporates the following features (and only the following features):</p>
<ol type="a">
<li><p>Long shift hours affect both how tired doctors are, and how much experience they have, both of which affect the quality of care</p>
<p><img src="images/DAG1.png" class="img-fluid"></p>
<p>L - Long hours</p>
<p>T - How tired they are</p>
<p>E - Experience</p>
<p>Q - Quality of care</p></li>
<li><p>How long shifts are is often decided by the hospital the doctor works at. There are plenty of other things about a given hospital that also affect the quality of care, like its funding level, how crowded it is, and so on</p>
<p><img src="images/DAG2.png" class="img-fluid"></p>
<p>H - Hospital</p>
<p>L - Long hours</p>
<p>C - Crowded</p>
<p>F - Funding</p>
<p>Q - Quality of care</p></li>
<li><p>New policies that reduce shift times may be implemented at the same time (with the timing determined by some unobservable change in policy preferences) as other policies that also attempt to improve the quality of care</p>
<p><img src="images/DAG3.png" class="img-fluid"></p>
<p>U - Unobservable change in policy preferences</p>
<p>P - Policy change</p>
<p>L - Long hours</p>
<p>O - Other policies</p>
<p>Q - Quality of care</p></li>
</ol>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3">3.4</h2>
<p><br>
Consider this research question: Does the funding level of public schools affect student achievement for students in your country?</p>
<ol type="a">
<li><p>What is the treatment and what is the outcome of interest?</p>
<p><strong>The treatment variable is the funding level of each school. The outcome of interest is student achievement.</strong></p></li>
<li><p>Write down a list of relevant variables.</p>
<p><strong>School funding, student achievement, parent SES, tutoring resources, county/city average SES, tax revenue</strong></p></li>
<li><p>Which of the variables in your list in part b are causes of both treatment and outcome?</p>
<p><strong>county/city SES</strong></p></li>
<li><p>Why might we want to pay extra attention to the variables listed in part c?</p>
<p><strong>They can affect the relationship between our variables of interest. For example, counties/cities with higher SES likely have more funding available for schools (via more tax revenue and such), and also, higher-income areas are more likely to have higher-income parents and higher-income parents are more likely to be able to afford tutoring for their children. More school funding and more tutoring resources are likely to result in higher achievement.</strong></p></li>
<li><p>Draw a causal diagram of the variables listed in part b.</p>
<p><img src="images/clipboard-2513041963.png" class="img-fluid"></p></li>
<li><p>Simplify the diagram from part e.</p>
<p><img src="images/clipboard-1045684182.png" class="img-fluid"></p>
<p><strong>Since all of the variables affecting School Funding and Student Achievement were related to County/City SES, I simplified the diagram by focusing on County/City SES. “Controlling” for county/city SES should theoretically mitigate the effects of the other variables. There are of course unobserved variables that can affect our results, and all of these confounders might not be fully explained by county/city SES, but I figured this is close to what you were asking for when you asked for me to simplify the diagram.</strong></p></li>
</ol>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4">3.5</h2>
<p><br>
How can a causal diagram be modified so as to avoid cyclic relationships?</p>
<p>Consider the diagram below. It depicts a cyclical relationship between student achievement and motivation. If students achieve more (i.e., score well on exams), then their motivation goes up, and if their motivation goes up, they achieve more. Change the diagram so that the relationship is not cyclic anymore.</p>
<p><img src="images/DAG4.png" class="img-fluid"></p>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5">3.6</h2>
<p>Assuming that a path has no colliders on it, what is the difference between a path being Open and Closed?</p>
<p><strong>In an open path, all of the variables on the path are allowed to vary. In a closed path, at least one variables on the path has no variation.</strong></p>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6">3.7</h2>
<p><img src="images/clipboard-1273882968.png" class="img-fluid" width="407"></p>
<ol type="a">
<li><p>List every path from X to Y.</p>
<p>X -&gt; A -&gt; Y</p>
<p>X &lt;- B -&gt; Y</p>
<p>X -&gt; C &lt;- D -&gt; Y</p>
<p>X &lt;- B &lt;- D -&gt; Y</p></li>
<li><p>Which of the paths are front-door paths?</p>
<p>X -&gt; A -&gt; Y</p></li>
<li><p>Which of the paths are open back-door paths?</p>
<p>X &lt;- B -&gt; Y</p>
<p>X &lt;- B &lt;- D -&gt; Y</p></li>
<li><p>What variables must be controlled for in order to identify the effect of X on Y? (only list what must be controlled for, not anything that additionally could be controlled for).</p>
<p>B</p></li>
</ol>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7">3.8</h2>
<p><br>
Which of the following describes a causal path where all the arrows point away from the treatment?</p>
<p><strong>c.&nbsp;Front Door Path</strong></p>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8">3.9</h2>
<p><img src="images/clipboard-3206163399.png" class="img-fluid"></p>
<ol type="a">
<li><p>What type of variable is Popularity in one path on this diagram?</p>
<p><strong>Collider variable.</strong></p></li>
<li><p>Discuss what would happen if you controlled for Popularity.</p>
<p><strong>It would open a path between teaching quality and number of publications.</strong></p></li>
</ol>
</section>
<section id="section-9" class="level2">
<h2 class="anchored" data-anchor-id="section-9">3.10</h2>
<p><br>
Go to the app Steve showed us in class.</p>
<p><a href="https://cbdrh.shinyapps.io/daggle/" class="uri">https://cbdrh.shinyapps.io/daggle/</a></p>
<p>Spend some time noodling around with it and upload screenshots with the right answer for three DAGs with 4, 6, and 8 nodes each. Set the complexity to “difficult.”</p>
<p>** These screenshots were taken AFTER daggle said that my answers were correct.</p>
<p>4 nodes -</p>
<p><img src="images/daggle-109747.png" class="img-fluid" width="342"></p>
<p><img src="images/daggle-109697.png" class="img-fluid" width="328"></p>
<p><img src="images/daggle-109677.png" class="img-fluid" width="345"></p>
<p>6 nodes -</p>
<p><img src="images/daggle-149747.png" class="img-fluid" width="335"></p>
<p><img src="images/daggle-149985.png" class="img-fluid" width="322"></p>
<p><img src="images/daggle-149909.png" class="img-fluid" width="357"></p>
<p>8 nodes -</p>
<p><img src="images/daggle-189269.png" class="img-fluid" width="369"></p>
<p><img src="images/daggle-189301.png" class="img-fluid" width="337"></p>
<p><img src="images/daggle-189569.png" class="img-fluid" width="347"></p>
</section>
<section id="section-10" class="level2">
<h2 class="anchored" data-anchor-id="section-10">3.11</h2>
<p><img src="images/clipboard-3108229154.png" class="img-fluid" width="497"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"hod_simulation_functions.R"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>) <span class="do">## include this so that grading is easier for me.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">hod_simulation</span>(<span class="at">N =</span> <span class="fl">1e3</span>, <span class="at">Bt =</span> <span class="dv">2</span>, <span class="at">Bx =</span> <span class="dv">4</span>, <span class="at">rho =</span> <span class="sc">-</span><span class="fl">0.8</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t) <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_y =</span> <span class="fu">mean</span>(y), <span class="at">mean_y0 =</span> <span class="fu">mean</span>(y0, <span class="at">na.rm =</span> T), <span class="at">mean_y1 =</span> <span class="fu">mean</span>(y1, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
      t mean_y mean_y0 mean_y1
  &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1     0   5.92    5.92    7.92
2     1   3.88    1.88    3.88</code></pre>
</div>
</div>
<ul>
<li><p>Without looking at the results just yet… do you think the naive estimate will be larger or smaller than the “real” estimate ( ATE = 2 )?</p>
<p><strong>Larger, since there is an open back-door path from T to Y, and X has a positive effect on Y.</strong></p></li>
<li><p>Check your answer. What are the results given by the naive estimator?</p>
<p><strong>5.72</strong></p></li>
<li><p>Re-do this but set <code>rho</code> to -0.8 (so that S and X are now negatively correlated).</p>
<p><strong>-2.04</strong></p></li>
</ul>
</section>
<section id="section-11" class="level2">
<h2 class="anchored" data-anchor-id="section-11">3.12</h2>
<p>Take the dataset&nbsp;<code>d</code>&nbsp;created in the previous question and modify it so that the treatment is now randomized (this will destroy the path between S and T).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dnew <span class="ot">=</span> d</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dnew<span class="sc">$</span>t <span class="ot">=</span> <span class="fu">sample</span>(dnew<span class="sc">$</span>t)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>dnew <span class="ot">=</span> <span class="fu">mutate</span>(dnew, <span class="at">y =</span> <span class="fu">ifelse</span>(t <span class="sc">==</span> <span class="dv">0</span>, y0, y1))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dnew <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_y =</span> <span class="fu">mean</span>(y), <span class="at">mean_y0 =</span> <span class="fu">mean</span>(y0, <span class="at">na.rm =</span> T), <span class="at">mean_y1 =</span> <span class="fu">mean</span>(y1, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
      t mean_y mean_y0 mean_y1
  &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1     0   3.67    3.67    5.67
2     1   6.02    4.02    6.02</code></pre>
</div>
</div>
<ul>
<li><p>Without looking at the results just yet… do you think the naive estimate will be larger or smaller than the “real” estimate ( ATE = 2 )?</p>
<p><strong>I think it should be closer to the real estimate, since it closes the back door path. It might be a little higher or a little lower.</strong></p></li>
<li><p>Check your answer. What are the results given by the naive estimator?</p>
<p><strong>2.35</strong></p></li>
<li><p>Use <code>lm()</code> to predict the newly created <code>y</code> from <code>t</code>. What are the coefficient values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(d<span class="sc">$</span>y <span class="sc">~</span> d<span class="sc">$</span>t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = d$y ~ d$t)

Coefficients:
(Intercept)          d$t  
      5.923       -2.043  </code></pre>
</div>
</div></li>
<li><p>Use <code>lm()</code> to predict the newly created <code>y</code> from <code>t</code> and <code>x</code>. What are the coefficient values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(d<span class="sc">$</span>y <span class="sc">~</span> d<span class="sc">$</span>t <span class="sc">+</span> d<span class="sc">$</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = d$y ~ d$t + d$x)

Coefficients:
(Intercept)          d$t          d$x  
      0.104        1.723        3.958  </code></pre>
</div>
</div></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>